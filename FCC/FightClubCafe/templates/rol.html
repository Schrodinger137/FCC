{% load static %}
<button class="fab-simple" data-bs-toggle="modal" data-bs-target="#rolGameModal">
  ▶
</button>

<style>
.fab-simple {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 60px;
  height: 60px;
  background: #ff6600;
  color: white;
  font-size: 26px;
  border-radius: 50%;
  border: none;
  cursor: pointer;
  z-index: 999;
}
</style>

<style>

.modal-content.pergamino {
  background: url("{% static 'img/pergamino.png' %}");
  background-size: cover;
  background-position: center;
  border: 3px solid #5a3e1b;
  border-radius: 12px;
  color: #2d1a0e;
  font-family: 'Georgia', serif;
  box-shadow: 0 0 30px rgba(0,0,0,0.8);
}

#rolContainer {
  padding: 20px;
}

.dialogo-box {
  display: flex;
  gap: 20px;
  align-items: flex-start;
}

.dialogo-box img {
  width: 120px;
  height: auto;
  border-radius: 10px;
  border: 3px solid #5a3e1b;
}

.dialogo-texto {
  flex: 1;
}

.btn-perg {
  background: #8b5a2b;
  border: none;
  color: #fff;
  font-weight: bold;
  border-radius: 6px;
}

.btn-perg:hover {
  background: #704622;
}

</style>

<div class="modal fade" id="rolGameModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content pergamino">
      
      <div class="modal-header border-0">
        <h1 class="modal-title fs-4">El Camino a la Caferna</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <div id="rolContainer"></div>
      </div>

      <div class="modal-footer border-0">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>

    </div>
  </div>
</div>

<script>

const IMG_TLACO = "{% static 'img/donTlaco.png' %}";
const IMG_HIERRO = "{% static 'img/hierroRojo.png' %}";
const IMG_NARRADOR = "{% static 'img/pergamino_icon.png' %}"; // opcional

let escena = 0;

function renderScene(personaje, contenidoHTML) {
  const box = document.getElementById("rolContainer");

  let img = "";
  if (personaje === "tlaco") img = IMG_TLACO;
  else if (personaje === "hierro") img = IMG_HIERRO;
  else img = IMG_NARRADOR;

  box.innerHTML = `
    <div class="dialogo-box">
      <img src="${img}">
      <div class="dialogo-texto">
        ${contenidoHTML}
      </div>
    </div>
  `;
}

function render() {
  switch(escena) {

    case 0:
      renderScene("hierro", `
        <h3>Hierro Rojo</h3>
        <p>
          Caminas por los callejones de Grano Oscuro.  
          Tu armadura rojiza pesa, pero tu misión pesa más.
        </p>
        <p>
          Buscas a un niño desaparecido…  
          pero el aroma a café te distrae.
        </p>

        <button class="btn-perg mt-3" onclick="escena=0.5; render()">Seguir el aroma</button>
        <button class="btn-perg mt-3" onclick="escena=0.6; render()">Ignorar y seguir tu misión</button>
      `);
      break;

    case 0.5:
      renderScene("tlaco", `
        <h3>Don Tlaco</h3>
        <p>
          “Sabía que vendrías, Hierro Rojo.”  
        </p>
        <p>
          “Los que cargan justicia… siempre huelen el grano oscuro.”
        </p>

        <button class="btn-perg mt-3" onclick="escena=1; render()">¿Quién eres?</button>
        <button class="btn-perg mt-3" onclick="escena=2; render()">Quítate. Tengo trabajo.</button>
      `);
      break;

    case 0.6:
      renderScene("hierro", `
        <h3>Hierro Rojo</h3>
        <p>
          Intentas alejarte…  
          pero el aroma te persigue como una sombra pegajosa.
        </p>
        <p>
          Una figura aparece frente a ti sin hacer ruido.
        </p>

        <button class="btn-perg mt-3" onclick="escena=0.5; render()">Enfrentarlo</button>
      `);
      break;

    case 1:
      renderScene("tlaco", `
        <h3>Don Tlaco</h3>
        <p>
          “Soy el barista mayor de esta ciudad...”  
        </p>
        <p>
          “Y tú… tú apestas a destino, Hierro Rojo.”  
        </p>

        <button class="btn-perg mt-3" onclick="escena=8; render()">Hablar como Hierro Rojo</button>
        <button class="btn-perg mt-3" onclick="escena=4; render()">Intentar alejarte</button>
      `);
      break;

    case 8:
      renderScene("hierro", `
        <h3>Hierro Rojo</h3>
        <p>
          “No sé qué quieras, viejo…  
          pero no vine por destino. Vine a ayudar a los míos.”
        </p>
        <p>
          “Si buscas pelea, no te la recomiendo.”
        </p>

        <button class="btn-perg mt-3" onclick="escena=3; render()">Escuchar</button>
      `);
      break;

    case 2:
      renderScene("tlaco", `
        <h3>No tengo tiempo</h3>
        <p>“Nadie rechaza una invitación de la Caferna.”</p>
        <button class="btn-perg mt-3" onclick="escena=3; render()">¿Qué invitación?</button>
      `);
      break;

    case 3:
      renderScene("tlaco", `
        <h3>La Caferna</h3>
        <p>“Un sitio que solo acepta a quienes están destinados a luchar.”</p>

        <button class="btn-perg mt-3" onclick="escena=5; render()">¿Por qué yo?</button>
        <button class="btn-perg mt-3" onclick="escena=6; render()">No pienso pelear.</button>
      `);
      break;

    case 4:
      renderScene("hierro", `
        <h3>Intentas alejarte…</h3>
        <p>
          Pero Don Tlaco aparece frente a ti otra vez.  
          No sabes cómo lo hace.
        </p>

        <button class="btn-perg mt-3" onclick="escena=3; render()">Está bien… habla.</button>
      `);
      break;

    case 5:
      renderScene("tlaco", `
        <h3>¿Por qué yo?</h3>
        <p>
          “Eres Hierro Rojo, defensor de los débiles.  
          La Caferna necesita a alguien como tú.”
        </p>

        <button class="btn-perg mt-3" onclick="escena=9; render()">Responder como Hierro Rojo</button>
      `);
      break;

    case 9:
      renderScene("hierro", `
        <h3>Hierro Rojo</h3>
        <p>
          “Si bajo ahí… no será por destino.”  
        </p>
        <p>
          “Será para proteger a quien lo necesite.”  
        </p>

        <button class="btn-perg mt-3" onclick="escena=7; render()">Descender a la Caferna</button>
      `);
      break;

    case 6:
      renderScene("tlaco", `
        <h3>No pienso pelear</h3>
        <p>“Todos pelean. La vida es eso.”</p>

        <button class="btn-perg mt-3" onclick="escena=9; render()">Aceptar el destino</button>
      `);
      break;

    case 7:
      renderScene("hierro", `
        <h3>La Arena de la Caferna</h3>
        <p>
          Bajas por las escaleras húmedas…  
          La multitud ruge tu nombre.
        </p>
        <p class="fw-bold text-danger">¡¡HIERRO ROJO!! ¡¡HIERRO ROJO!!</p>

        <h4 class="mt-3">Fin del prólogo.</h4>

        <button class="btn-perg mt-3" onclick="escena=0; render()">Volver a jugar</button>
      `);
      break;
  }
}


// Reiniciar al abrir
document.getElementById('rolGameModal').addEventListener('show.bs.modal', () => {
  escena = 0;
  render();
});

</script>