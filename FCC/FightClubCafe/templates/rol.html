{% load static %}
<button class="fab-simple" data-bs-toggle="modal" data-bs-target="#rolGameModal">
  ▶
</button>

<style>
.fab-simple {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 60px;
  height: 60px;
  background: #ff6600;
  color: white;
  font-size: 26px;
  border-radius: 50%;
  border: none;
  cursor: pointer;
  z-index: 999;
}
</style>

<style>

.modal-content.pergamino {
  background: url("{% static 'img/pergamino.png' %}");
  background-size: cover;
  background-position: center;
  border: 3px solid #5a3e1b;
  border-radius: 12px;
  color: #2d1a0e;
  font-family: 'Georgia', serif;
  box-shadow: 0 0 30px rgba(0,0,0,0.8);
}

#rolContainer {
  padding: 20px;
}

.dialogo-box {
  display: flex;
  gap: 20px;
  align-items: flex-start;
}

.dialogo-box img {
  width: 120px;
  height: auto;
  border-radius: 10px;
  border: 3px solid #5a3e1b;
}

.dialogo-texto {
  flex: 1;
}

.btn-perg {
  background: #8b5a2b;
  border: none;
  color: #fff;
  font-weight: bold;
  border-radius: 6px;
}

.btn-perg:hover {
  background: #704622;
}

</style>

<div class="modal fade" id="rolGameModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content pergamino">
      
      <div class="modal-header border-0">
        <h1 class="modal-title fs-4">El Camino a la Caferna</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <div id="rolContainer"></div>
      </div>

      <div class="modal-footer border-0">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>

    </div>
  </div>
</div>

<script>

const IMG_TLACO = "{% static 'img/donTlaco.png' %}";
const IMG_HIERRO = "{% static 'img/hierroRojo.png' %}";
const IMG_NARRADOR = "{% static 'img/pergamino_icon.png' %}"; // opcional

let escena = 0;

function renderScene(personaje, contenidoHTML) {
  const box = document.getElementById("rolContainer");

  let img = "";
  if (personaje === "tlaco") img = IMG_TLACO;
  else if (personaje === "hierro") img = IMG_HIERRO;
  else img = IMG_NARRADOR;

  box.innerHTML = `
    <div class="dialogo-box">
      <img src="${img}">
      <div class="dialogo-texto">
        ${contenidoHTML}
      </div>
    </div>
  `;
}

function render() {
  switch(escena) {

    /* ────────────── NARRADOR 1 ────────────── */
    case 0:
      renderScene("narrador", `
        <h3>Narrador</h3>
        <p>
          Los callejones de Grano Oscuro respiran niebla y olor a granos tostados.  
          Entre las sombras, una figura avanza con paso firme: Hierro Rojo.
        </p>
        <p>
          Su armadura rojiza refleja brasas vivas. Busca a un niño desaparecido…  
          pero un aroma tibio y dulce lo envuelve como si tuviera voluntad propia.
        </p>

        <button class="btn-perg mt-3" onclick="escena=0.5; render()">Seguir el aroma</button>
        <button class="btn-perg mt-3" onclick="escena=0.6; render()">Resistirse y seguir la misión</button>
      `);
      break;

    /* ────────────── TLACO 1 ────────────── */
    case 0.5:
      renderScene("tlaco", `
        <h3>Don Tlaco</h3>
        <p>
          “Ah… Hierro Rojo. El eco de tus pasos llegó antes que tú.”
        </p>
        <p>
          “Los protectores siempre siguen los olores del destino…  
          aunque crean que solo es café.”
        </p>

        <button class="btn-perg mt-3" onclick="escena=1; render()">“¿Quién eres tú?”</button>
        <button class="btn-perg mt-3" onclick="escena=2; render()">“Apártate.”</button>
      `);
      break;

    /* ────────────── HIERRO 1 ────────────── */
    case 0.6:
      renderScene("hierro", `
        <h3>Hierro Rojo</h3>
        <p>
          Te obligas a ignorar el aroma… pero es inútil.  
          Es como si el aire mismo intentara arrastrarte.
        </p>
        <p>
          Hasta que una figura se materializa frente a ti sin un solo ruido.
        </p>

        <button class="btn-perg mt-3" onclick="escena=0.5; render()">Enfrentarlo</button>
      `);
      break;

    /* ────────────── TLACO 2 ────────────── */
    case 1:
      renderScene("tlaco", `
        <h3>Don Tlaco</h3>
        <p>
          “Soy Don Tlaco, barista mayor de Grano Oscuro…  
          y custodio de algo más antiguo que estas calles.”
        </p>
        <p>
          “Y tú… llevas olor a propósito.”
        </p>

        <button class="btn-perg mt-3" onclick="escena=8; render()">Responder como Hierro Rojo</button>
        <button class="btn-perg mt-3" onclick="escena=4; render()">Intentar alejarte</button>
      `);
      break;

    /* ────────────── HIERRO 2 ────────────── */
    case 8:
      renderScene("hierro", `
        <h3>Hierro Rojo</h3>
        <p>
          “No creo en destinos.  
          Creo en la gente que necesita ayuda.”
        </p>
        <p>
          “Si buscas problemas, te advierto: estoy de mal humor.”
        </p>

        <button class="btn-perg mt-3" onclick="escena=3; render()">Escuchar</button>
      `);
      break;

    /* ────────────── TLACO 3 ────────────── */
    case 2:
      renderScene("tlaco", `
        <h3>Don Tlaco</h3>
        <p>
          “No puedes rechazar una invitación de la Caferna.”  
          Su voz es suave… pero firme como un adoquín.
        </p>

        <button class="btn-perg mt-3" onclick="escena=3; render()">“¿Qué invitación?”</button>
      `);
      break;

    /* ────────────── TLACO EXPLICA LA CAFERNA ────────────── */
    case 3:
      renderScene("tlaco", `
        <h3>La Caferna</h3>
        <p>
          “Es un lugar de lucha, de humo, de destino.  
          Solo entra quien está marcado para cambiar algo.”
        </p>

        <button class="btn-perg mt-3" onclick="escena=5; render()">“¿Por qué yo?”</button>
        <button class="btn-perg mt-3" onclick="escena=6; render()">“No lucharé.”</button>
      `);
      break;

    /* ────────────── HIERRO 3 ────────────── */
    case 4:
      renderScene("hierro", `
        <h3>Hierro Rojo</h3>
        <p>
          Intentas retroceder…  
          pero Don Tlaco ya está frente a ti de nuevo.  
          No sabes si se teletransporta o si simplemente respira a tiempo.
        </p>

        <button class="btn-perg mt-3" onclick="escena=3; render()">Suspirar y escucharlo</button>
      `);
      break;

    /* ────────────── TLACO 4 ────────────── */
    case 5:
      renderScene("tlaco", `
        <h3>¿Por qué tú?</h3>
        <p>
          “Porque defiendes a los débiles.  
          Porque cargas una armadura que pesa más por dentro que por fuera.”
        </p>
        <p>
          “Porque la Caferna necesita un corazón así.”
        </p>

        <button class="btn-perg mt-3" onclick="escena=9; render()">Responder</button>
      `);
      break;

    /* ────────────── NARRADOR 2 ────────────── */
    case 9:
      renderScene("narrador", `
        <h3>Narrador</h3>
        <p>
          El aire se espesa.  
          Un rumor subterráneo golpea el suelo bajo tus botas.
        </p>
        <p>
          La ciudad calla… como si toda Grano Oscuro esperara tu decisión.
        </p>

        <button class="btn-perg mt-3" onclick="escena=7; render()">Descender a la Caferna</button>
      `);
      break;

    /* ────────────── TLACO 5 ────────────── */
    case 6:
      renderScene("tlaco", `
        <h3>Don Tlaco</h3>
        <p>
          “Todos pelean, Hierro Rojo.  
          Algunos con espadas… otros con decisiones.”
        </p>
        <p>
          “La Caferna solo te muestra quién eres.”
        </p>

        <button class="btn-perg mt-3" onclick="escena=9; render()">Aceptar tu papel</button>
      `);
      break;

    /* ────────────── NARRADOR 3 / FINAL ────────────── */
    case 7:
      renderScene("narrador", `
        <h3>Narrador</h3>
        <p>
          Desciendes por una escalera húmeda, iluminada por brasas flotantes.  
          El rumor se vuelve rugido.
        </p>
        <p>
          Cuando cruzas el arco final, cientos de voces gritan tu nombre:
        </p>
        <p class="fw-bold text-danger fs-4">
          “¡¡HIERRO ROJO!! ¡¡HIERRO ROJO!!”
        </p>

        <p>
          La arena espera. Tu destino también.
        </p>

        <h4 class="mt-3">Fin del prólogo.</h4>

        <button class="btn-perg mt-3" onclick="escena=0; render()">Volver a jugar</button>
      `);
      break;
  }
}


// Reiniciar al abrir
document.getElementById('rolGameModal').addEventListener('show.bs.modal', () => {
  escena = 0;
  render();
});

</script>