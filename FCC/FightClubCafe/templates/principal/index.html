{% extends 'base.html' %}
{% load static %}

{% block title %}Fight Club Cafe{% endblock %}

{% block content %}


<!-- ============================
      HERO FULLSCREEN PRINCIPAL
=============================== -->
<section class="hero-fullscreen fade-in">
  <div class="container px-4">
    <h4>No importa quién seas.
      <br>
      No importa de dónde vengas.
      <br>
      No importa por qué bajaste los escalones que llevan a este submundo.
      <br>
      Ya no eres un visitante.
      <br><br>
      Eres un combatiente.

      Bienvenido a...
    </h4>
    <h1 class="text-naranja-brillante">Fight Club Café</h1>
    <h2>Jugadores</h2>
    <h1 class="text-naranja-brillante">{{ usuarios_count }}</h1>
  </div>
</section>



<!-- ============================
      PRIMERA DUPLA (Deck izquierda / Hero derecha)
=============================== -->
<section class="dual-section">

  <div class="half">
    <h1 class="text-center">Personajes</h1>
    <div class="deck-container mt-5">
      {% for personaje in personajes %}
      <div class="deck-card">
        <img src="{{ personaje.imagen }}" alt="{{ personaje.nombre }}">
        <div class="deck-info">
          <h3>{{ personaje.nombre }}</h3>
          <p><strong>Descripción:</strong> {{ personaje.descripcion }}</p>
          <p><strong>Daño:</strong> {{ personaje.dano }}</p>
          <p><strong>Velocidad:</strong> {{ personaje.velocidad }}</p>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <div class="half">
    <section class="hero-side fade-in">
      <div>
        <h1 class="text-center mb-4">Historia</h1>

        <div class="lore-container">
          <div class="lore-card">
            En las entrañas de la ciudad de Grano Oscuro, más abajo de los callejones donde se esconde el humo y la
            miseria, existe un lugar al que nadie llega por accidente. Un sitio del que se susurra en los mercados, que
            se teme en las tabernas, y que ni los borrachos más valientes se atreverían a mencionar sin voltear a ver si
            alguien escucha.

            Ese lugar se llama La Caferna.

            No aparece en ningún mapa, y nadie sabe quién la construyó. Algunos dicen que fue un gremio de baristas
            monjes que buscaban refugio del mundo; otros aseguran que sus muros fueron levantados por luchadores
            renegados, escapando de la justicia. Lo único que todos coinciden es que La Caferna no invita—escoge.

            Sus puertas solo se abren para quienes llevan algo hirviendo en el alma: rencor, ambición, desesperación, o
            simplemente una sed tan profunda que ni el café más amargo podría saciar.

            Dentro, el ambiente es espeso, cargado del aroma a granos tostados y sudor viejo. Vasos rotos adornan el
            suelo como cicatrices, mientras la barra, hecha de madera centenaria, vibra con cada impacto que retumba
            desde la arena central. Nadie entra buscando café.
            Pero todos terminan necesitándolo.

            Porque en La Caferna, el café no es una bebida.
            Es poder.
            <br><br>Es poder.
          </div>

          <img src="{% static 'img/2.png' %}" class="lore-img">
        </div>
      </div>
    </section>
  </div>

</section>

<section class="dual-section">

  <div class="half">
    <section class="hero-side fade-in">
      <div>
        <h1 class="text-center mb-4">Los Diez Granos</h1>

        <div class="lore-container">
          <div class="lore-card">
            Cuenta la leyenda que, en lo más profundo de la Caferna, existe un molino antiguo que nunca ha dejado de
            girar. Nadie lo ha visto funcionar, pero todas las noches se oye su ronquido metálico, como si dentro
            viviera un monstruo dormido, alimentado por granos que jamás crecieron a la luz del sol.

            Dicen que el café que produce no es normal.
            Que puede acelerar el corazón hasta hacer ver el futuro.
            Que vuelve el golpe más torpe en un misil.
            Que, si lo tomas en exceso… puedes despertar a algo dentro de ti que no sabías que estaba vivo.

            A ese poder se le conoce como Los Diez Granos.

            Y para controlar ese poder, se creó un torneo.
          </div>

          <img src="{% static 'img/3.png' %}" class="lore-img">
        </div>
      </div>
    </section>
  </div>

  <div class="half">
    <h1 class="text-center">Items</h1>
    <div class="deck-container mt-4">
      {% for item in items %}
      <div class="deck-card">
        <img src="{{ item.imagen }}" alt="{{ item.nombre }}">
        <div class="deck-info">
          <h3>{{ item.nombre }}</h3>
          <p><strong>Duración:</strong> {{ item.duracion }}</p>
          <p><strong>Daño:</strong> {{ item.aumentoDano }}</p>
          <p><strong>Velocidad:</strong> {{ item.aumentoVelocidad }}</p>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

</section>

<button class="fab-simple" data-bs-toggle="modal" data-bs-target="#rolGameModal">
  ▶
</button>

<style>
.fab-simple {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 60px;
  height: 60px;
  background: #ff6600;
  color: white;
  font-size: 26px;
  border-radius: 50%;
  border: none;
  cursor: pointer;
  z-index: 999;
}
</style>

<style>

.modal-content.pergamino {
  background: url("{% static 'img/pergamino.png' %}");
  background-size: cover;
  background-position: center;
  border: 3px solid #5a3e1b;
  border-radius: 12px;
  color: #2d1a0e;
  font-family: 'Georgia', serif;
  box-shadow: 0 0 30px rgba(0,0,0,0.8);
}

#rolContainer {
  padding: 20px;
}

.dialogo-box {
  display: flex;
  gap: 20px;
  align-items: flex-start;
}

.dialogo-box img {
  width: 120px;
  height: auto;
  border-radius: 10px;
  border: 3px solid #5a3e1b;
}

.dialogo-texto {
  flex: 1;
}

.btn-perg {
  background: #8b5a2b;
  border: none;
  color: #fff;
  font-weight: bold;
  border-radius: 6px;
}

.btn-perg:hover {
  background: #704622;
}

</style>

<div class="modal fade" id="rolGameModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content pergamino">
      
      <div class="modal-header border-0">
        <h1 class="modal-title fs-4">El Camino a la Caferna</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <div id="rolContainer"></div>
      </div>

      <div class="modal-footer border-0">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>

    </div>
  </div>
</div>

<script>

const IMG_TLACO = "{% static 'img/donTlaco.png' %}";
const IMG_HIERRO = "{% static 'img/hierroRojo.png' %}";
const IMG_NARRADOR = "{% static 'img/pergamino_icon.png' %}"; // opcional

let escena = 0;

function renderScene(personaje, contenidoHTML) {
  const box = document.getElementById("rolContainer");

  let img = "";
  if (personaje === "tlaco") img = IMG_TLACO;
  else if (personaje === "hierro") img = IMG_HIERRO;
  else img = IMG_NARRADOR;

  box.innerHTML = `
    <div class="dialogo-box">
      <img src="${img}">
      <div class="dialogo-texto">
        ${contenidoHTML}
      </div>
    </div>
  `;
}

function render() {
  switch(escena) {

    case 0:
      renderScene("hierro", `
        <h3>Hierro Rojo</h3>
        <p>
          Caminas por los callejones de Grano Oscuro.  
          Tu armadura rojiza pesa, pero tu misión pesa más.
        </p>
        <p>
          Buscas a un niño desaparecido…  
          pero el aroma a café te distrae.
        </p>

        <button class="btn-perg mt-3" onclick="escena=0.5; render()">Seguir el aroma</button>
        <button class="btn-perg mt-3" onclick="escena=0.6; render()">Ignorar y seguir tu misión</button>
      `);
      break;

    case 0.5:
      renderScene("tlaco", `
        <h3>Don Tlaco</h3>
        <p>
          “Sabía que vendrías, Hierro Rojo.”  
        </p>
        <p>
          “Los que cargan justicia… siempre huelen el grano oscuro.”
        </p>

        <button class="btn-perg mt-3" onclick="escena=1; render()">¿Quién eres?</button>
        <button class="btn-perg mt-3" onclick="escena=2; render()">Quítate. Tengo trabajo.</button>
      `);
      break;

    case 0.6:
      renderScene("hierro", `
        <h3>Hierro Rojo</h3>
        <p>
          Intentas alejarte…  
          pero el aroma te persigue como una sombra pegajosa.
        </p>
        <p>
          Una figura aparece frente a ti sin hacer ruido.
        </p>

        <button class="btn-perg mt-3" onclick="escena=0.5; render()">Enfrentarlo</button>
      `);
      break;

    case 1:
      renderScene("tlaco", `
        <h3>Don Tlaco</h3>
        <p>
          “Soy el barista mayor de esta ciudad...”  
        </p>
        <p>
          “Y tú… tú apestas a destino, Hierro Rojo.”  
        </p>

        <button class="btn-perg mt-3" onclick="escena=8; render()">Hablar como Hierro Rojo</button>
        <button class="btn-perg mt-3" onclick="escena=4; render()">Intentar alejarte</button>
      `);
      break;

    case 8:
      renderScene("hierro", `
        <h3>Hierro Rojo</h3>
        <p>
          “No sé qué quieras, viejo…  
          pero no vine por destino. Vine a ayudar a los míos.”
        </p>
        <p>
          “Si buscas pelea, no te la recomiendo.”
        </p>

        <button class="btn-perg mt-3" onclick="escena=3; render()">Escuchar</button>
      `);
      break;

    case 2:
      renderScene("tlaco", `
        <h3>No tengo tiempo</h3>
        <p>“Nadie rechaza una invitación de la Caferna.”</p>
        <button class="btn-perg mt-3" onclick="escena=3; render()">¿Qué invitación?</button>
      `);
      break;

    case 3:
      renderScene("tlaco", `
        <h3>La Caferna</h3>
        <p>“Un sitio que solo acepta a quienes están destinados a luchar.”</p>

        <button class="btn-perg mt-3" onclick="escena=5; render()">¿Por qué yo?</button>
        <button class="btn-perg mt-3" onclick="escena=6; render()">No pienso pelear.</button>
      `);
      break;

    case 4:
      renderScene("hierro", `
        <h3>Intentas alejarte…</h3>
        <p>
          Pero Don Tlaco aparece frente a ti otra vez.  
          No sabes cómo lo hace.
        </p>

        <button class="btn-perg mt-3" onclick="escena=3; render()">Está bien… habla.</button>
      `);
      break;

    case 5:
      renderScene("tlaco", `
        <h3>¿Por qué yo?</h3>
        <p>
          “Eres Hierro Rojo, defensor de los débiles.  
          La Caferna necesita a alguien como tú.”
        </p>

        <button class="btn-perg mt-3" onclick="escena=9; render()">Responder como Hierro Rojo</button>
      `);
      break;

    case 9:
      renderScene("hierro", `
        <h3>Hierro Rojo</h3>
        <p>
          “Si bajo ahí… no será por destino.”  
        </p>
        <p>
          “Será para proteger a quien lo necesite.”  
        </p>

        <button class="btn-perg mt-3" onclick="escena=7; render()">Descender a la Caferna</button>
      `);
      break;

    case 6:
      renderScene("tlaco", `
        <h3>No pienso pelear</h3>
        <p>“Todos pelean. La vida es eso.”</p>

        <button class="btn-perg mt-3" onclick="escena=9; render()">Aceptar el destino</button>
      `);
      break;

    case 7:
      renderScene("hierro", `
        <h3>La Arena de la Caferna</h3>
        <p>
          Bajas por las escaleras húmedas…  
          La multitud ruge tu nombre.
        </p>
        <p class="fw-bold text-danger">¡¡HIERRO ROJO!! ¡¡HIERRO ROJO!!</p>

        <h4 class="mt-3">Fin del prólogo.</h4>

        <button class="btn-perg mt-3" onclick="escena=0; render()">Volver a jugar</button>
      `);
      break;
  }
}


// Reiniciar al abrir
document.getElementById('rolGameModal').addEventListener('show.bs.modal', () => {
  escena = 0;
  render();
});

</script>



{% endblock %}